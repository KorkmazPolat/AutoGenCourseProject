{% extends "base.html" %}

{% block title %}Final Course - {{ course_title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-xl">
  <div class="mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Final Course (Agentic + Video)</h1>
    <p class="text-gray-600 mt-2">Agentic content plus rendered videos.</p>
  </div>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Overview</h2>
    <p class="text-sm text-gray-600">
      <span class="font-semibold">Title:</span> {{ course_title }}<br>
      <span class="font-semibold">Audience:</span> {{ audience or "—" }}<br>
      <span class="font-semibold">Tone:</span> {{ tone or "—" }}<br>
      <span class="font-semibold">Duration (min):</span> {{ duration_minutes or "—" }}
    </p>
  </section>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">Modules & Lessons</h2>
    <div class="space-y-4">
      {% for module in modules %}
      <div class="border-l-2 border-blue-200 pl-3">
        <div class="font-semibold text-gray-900 mb-1">{{ module.title }}</div>
        <ul class="ml-3 space-y-2 text-sm text-gray-800">
          {% for lesson in lessons %}
          {% if loop.index0 < module.lessons | length %}
          <li class="border-l border-gray-200 pl-3">
            <div class="font-semibold">{{ lesson.title }}</div>
            <p class="text-xs text-gray-600 mt-1">{{ lesson.summary }}</p>
          </li>
          {% endif %}
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
    </div>
  </section>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">Videos</h2>
    <p class="text-sm text-gray-600 mb-2">
      Videos rendered from agent-generated scripts. Listed in the same order as lessons.
    </p>
    <ul class="space-y-3 text-sm text-gray-800">
      {% for video in videos %}
      <li class="border border-gray-200 rounded-lg p-3">
        <div class="font-semibold text-gray-900">Lesson {{ loop.index }}</div>
        {% if video.video_url %}
        <video controls class="mt-2 w-full rounded-lg bg-black">
          <source src="{{ video.video_url }}" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        {% else %}
        <p class="text-xs text-gray-500 mt-1">Video file: {{ video.video_path }}</p>
        {% endif %}
      </li>
      {% endfor %}
    </ul>
  </section>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">Lesson Content</h2>
    <p class="text-sm text-gray-600 mb-2">Full text for each lesson, generated by the agentic pipeline.</p>
    <div class="space-y-4 text-sm text-gray-800">
      {% for lesson in lessons %}
      <article class="border border-gray-200 rounded-lg p-4">
        <h3 class="font-semibold text-gray-900">{{ lesson.title }}</h3>
        {% if lesson.summary %}
        <p class="text-gray-600 text-xs mt-1"><strong>Summary:</strong> {{ lesson.summary }}</p>
        {% endif %}
        {% if lesson.text %}
        <pre class="mt-2 whitespace-pre-wrap text-gray-800 text-xs max-h-64 overflow-auto">{{ lesson.text }}</pre>
        {% endif %}
      </article>
      {% endfor %}
    </div>
  </section>

  <section>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Quizzes</h2>
    <p class="text-sm text-gray-600 mb-2">One quiz per lesson (summary view).</p>
    <p class="text-sm text-gray-600">Total quizzes: {{ quizzes | length }}</p>
  </section>
</div>
{% endblock %}
