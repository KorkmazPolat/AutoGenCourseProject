<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Course Builder (alpha)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 24px;
        background: #f5f5f5;
        color: #1f2933;
      }
      main {
        max-width: 720px;
        margin: 0 auto;
        background: #ffffff;
        border: 1px solid #d2d6dc;
        padding: 24px;
      }
      h1 {
        margin-top: 0;
      }
      form {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      label {
        font-weight: bold;
      }
      input,
      textarea {
        font: inherit;
        padding: 8px;
        border: 1px solid #cbd2d9;
        background: #ffffff;
      }
      textarea {
        min-height: 140px;
      }
      small {
        color: #52606d;
      }
      button {
        padding: 10px;
        font: inherit;
        cursor: pointer;
        background: #2563eb;
        color: white;
        border: none;
      }
      button.secondary {
        background: transparent;
        color: #2563eb;
        border: 1px solid #2563eb;
      }
      .actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 12px;
      }
      p.note {
        margin-top: 24px;
        font-size: 0.9rem;
        color: #52606d;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Course Builder (very early draft)</h1>
      <p>Enter a working title and a few learning outcomes. We'll sketch the rest for you.</p>

      <form method="post" action="/create-course-plan">
        <label for="course_title">Course title</label>
        <input id="course_title" name="course_title" type="text" required placeholder="Intro to Prompt Engineering" />

        <label for="audience">Audience (optional)</label>
        <input id="audience" name="audience" type="text" placeholder="New product managers" />

        <label for="tone">Tone (optional)</label>
        <input id="tone" name="tone" type="text" placeholder="Practical and friendly" />

        <label for="duration_minutes">Target video duration (minutes)</label>
        <input id="duration_minutes" name="duration_minutes" type="number" min="1" placeholder="10" />

        <label for="learning_outcomes">Learning outcomes (one per line)</label>
        <textarea
          id="learning_outcomes"
          name="learning_outcomes"
          required
          placeholder="- Explain why prompt design matters
- Compare prompting patterns
- Use prompts to debug failures"
        ></textarea>

        <label for="voice">Voice (optional)</label>
        <input id="voice" name="voice" type="text" placeholder="alloy" />

        <label for="tts_model">TTS model (optional)</label>
        <input id="tts_model" name="tts_model" type="text" placeholder="gpt-4o-mini-tts" />

        <label for="theme">Theme (optional)</label>
        <select id="theme" name="theme">
          <option value="">Default (dark)</option>
          <option value="dark">Dark</option>
          <option value="light">Light</option>
        </select>

        <label for="logo_path">Logo path (optional)</label>
        <input id="logo_path" name="logo_path" type="text" placeholder="/path/to/logo.png" />

        <div class="actions">
          <button type="submit">Create course plan</button>
          <button type="submit" class="secondary" formaction="/create-course-pages">Build module pages</button>
          <button type="submit" class="secondary" formaction="/create-course-video">Generate video only</button>
          <button type="submit" class="secondary" formaction="/create-full-course">Build full course (with videos)</button>
        </div>
      </form>

      <p class="note">This interface is intentionally simple while we test the workflow.</p>
    </main>
  </body>
  <script>
    (function () {
      const form = document.querySelector('form');
      if (!form) return;

      function renderOverlay() {
        const overlay = document.createElement('div');
        overlay.id = 'loading-overlay';
        overlay.style.position = 'fixed';
        overlay.style.inset = '0';
        overlay.style.background = 'rgba(255,255,255,0.9)';
        overlay.style.display = 'flex';
        overlay.style.flexDirection = 'column';
        overlay.style.alignItems = 'center';
        overlay.style.justifyContent = 'center';
        overlay.style.zIndex = '9999';

        const box = document.createElement('div');
        box.style.width = 'min(520px, 90vw)';
        box.style.border = '1px solid #d2d6dc';
        box.style.background = '#fff';
        box.style.padding = '20px';
        box.style.boxShadow = '0 8px 24px rgba(0,0,0,0.08)';

        const title = document.createElement('div');
        title.textContent = 'Creating your content…';
        title.style.fontSize = '18px';
        title.style.fontWeight = 'bold';
        title.style.marginBottom = '12px';

        const barWrap = document.createElement('div');
        barWrap.style.height = '10px';
        barWrap.style.background = '#eef2f7';
        barWrap.style.border = '1px solid #d2d6dc';
        barWrap.style.position = 'relative';
        barWrap.style.overflow = 'hidden';
        barWrap.style.borderRadius = '6px';

        const bar = document.createElement('div');
        bar.id = 'progress-bar';
        bar.style.height = '100%';
        bar.style.width = '0%';
        bar.style.background = '#2563eb';
        bar.style.transition = 'width 200ms ease-out';

        barWrap.appendChild(bar);

        const pct = document.createElement('div');
        pct.id = 'progress-text';
        pct.textContent = '0%';
        pct.style.marginTop = '8px';
        pct.style.fontFamily = 'monospace';
        pct.style.color = '#52606d';

        const hint = document.createElement('div');
        hint.id = 'progress-hint';
        hint.textContent = 'Drafting materials…';
        hint.style.marginTop = '8px';
        hint.style.color = '#52606d';

        box.appendChild(title);
        box.appendChild(barWrap);
        box.appendChild(pct);
        box.appendChild(hint);
        overlay.appendChild(box);
        document.body.appendChild(overlay);
        return { overlay, bar, pct, hint };
      }

      form.addEventListener('submit', function (e) {
        const submitter = e.submitter || document.activeElement;
        const targetAction = submitter && submitter.getAttribute('formaction') ? submitter.getAttribute('formaction') : form.getAttribute('action');
        if (!targetAction) return; // let browser submit normally

        e.preventDefault();
        const ui = renderOverlay();

        const fd = new FormData(form);
        // carry which button was used (helps server if branching)
        if (submitter && submitter.name) fd.append(submitter.name, submitter.value || '');

        let pct = 0;
        const milestones = [15, 35, 55, 75, 90];
        const hints = [
          'Drafting plan…',
          'Outlining slides…',
          'Writing narration…',
          'Rendering visuals…',
          'Finalizing output…. (This process will take some time... Dont worry)'
        ];
        let step = 0;
        const timer = setInterval(() => {
          if (step < milestones.length && pct < milestones[step]) {
            pct += Math.max(1, Math.round((milestones[step] - pct) / 5));
          } else if (step < milestones.length) {
            step++;
            ui.hint.textContent = hints[Math.min(step, hints.length - 1)];
          } else if (pct < 95) {
            pct += 1;
          }
          ui.bar.style.width = pct + '%';
          ui.pct.textContent = pct + '%';
        }, 250);

        fetch(targetAction, { method: 'POST', body: fd, credentials: 'same-origin' })
          .then(async (resp) => {
            const html = await resp.text();
            pct = 100; ui.bar.style.width = '100%'; ui.pct.textContent = '100%';
            clearInterval(timer);
            // Replace the full document with the response HTML
            document.open();
            document.write(html);
            document.close();
          })
          .catch((err) => {
            clearInterval(timer);
            ui.hint.textContent = 'Something went wrong. Please try again.';
            ui.hint.style.color = '#b91c1c';
          });
      });
    })();
  </script>
</html>
