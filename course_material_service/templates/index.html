{% extends "base.html" %}

{% block head %}
  {{ super() }}
  <style>
    .animate-fadeIn { animation: fadeIn 0.5s ease-in-out forwards; }
    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

    /* Card hover effect */
    .form-card:hover, .stat-card:hover, #video-list > div:hover {
      transform: translateY(-2px) scale(1.02);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* Video list */
    #video-list { max-height: 300px; overflow-y: auto; padding-right:4px; }
    #video-list::-webkit-scrollbar { width:8px; }
    #video-list::-webkit-scrollbar-thumb { background-color: rgba(100,116,139,0.5); border-radius:4px; }
    #video-list > div { transition: transform 0.2s ease, box-shadow 0.2s ease; }

    /* Loading overlay */
    #loading-overlay { backdrop-filter: blur(2px); transition: opacity 0.3s ease; }
    #loading-overlay .bg-white { max-width: 400px; width: 90%; }

    #progress-bar { transition: width 0.2s ease; }

    /* Input focus */
    #course-form input:focus,
    #course-form textarea:focus { border-color: #4f46e5; box-shadow: 0 0 0 2px rgba(79,70,229,0.3); }

    /* Buttons hover */
    #course-form button:hover { transform: scale(1.03); transition: transform 0.2s ease; }

    /* Form container width */
    .form-container { max-width: 800px; width: 100%; }

    #document-dropzone {
      transition: all 0.2s ease;
      cursor: pointer;
    }
    #document-dropzone.dragover {
      border-color: #4f46e5;
      background-color: rgba(79,70,229,0.08);
    }
    #document-dropzone.success {
      border-color: #22c55e;
      background-color: rgba(34,197,94,0.1);
    }
    #document-dropzone.error {
      border-color: #ef4444;
      background-color: rgba(239,68,68,0.1);
    }
    #document-dropzone.uploading {
      opacity: 0.6;
      pointer-events: none;
    }
  </style>
{% endblock %}

{% block content %}
<div class="min-h-screen flex flex-col items-center justify-start space-y-10 py-10">

  <div class="form-container w-full flex flex-col items-center">

    <!-- Form Card -->
    <div class="bg-white shadow-2xl rounded-3xl p-10 form-card w-full">
      <div class="text-center mb-8">
        <p class="text-gray-600 text-lg">Enter your course details and watch it come to life! Professional, fast, and user-friendly.</p>
      </div>

      <form id="course-form" method="post" action="/create-course-plan" class="space-y-5">
        {% for field in ['course_title', 'audience', 'tone', 'duration_minutes'] %}
        <div>
          <label class="block text-gray-700 font-semibold mb-1" for="{{ field }}">{{ field.replace('_', ' ') | title }}</label>
          <input id="{{ field }}" name="{{ field }}" type="{{ 'number' if field=='duration_minutes' else 'text' }}" 
                 placeholder="Enter {{ field.replace('_', ' ') }}" 
                 class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:outline-none" 
                 value="{{ values.get(field,'') }}">
        </div>
        {% endfor %}

        <div>
          <label class="block text-gray-700 font-semibold mb-1" for="document-dropzone">Course Materials (PDF)</label>
          <div id="document-dropzone" class="flex flex-col items-center justify-center gap-2 border-2 border-dashed border-indigo-200 bg-indigo-50/40 rounded-xl py-6 px-4 text-center text-indigo-900">
            <input id="document-input" type="file" accept="application/pdf" class="hidden">
            <svg class="w-10 h-10 text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 15.75l7.5-7.5 4.5 4.5 3-3M21 12v7.5a1.5 1.5 0 01-1.5 1.5h-15A1.5 1.5 0 013 19.5v-9A1.5 1.5 0 014.5 9h4.75" />
            </svg>
            <p class="text-sm font-semibold">Drag & drop a PDF here</p>
            <p class="text-sm text-indigo-600">
              or
              <button type="button" id="document-browse" class="font-semibold underline underline-offset-4 hover:text-indigo-800">browse files</button>
            </p>
            <p class="text-xs text-indigo-500">Upload course source material to ground the AI outputs.</p>
          </div>
          <p id="document-status" class="mt-2 text-sm text-gray-500">No document uploaded yet.</p>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-1" for="learning_outcomes">Learning Outcomes</label>
          <textarea id="learning_outcomes" name="learning_outcomes" rows="5" 
                    placeholder="- Explain why prompt design matters
- Compare prompting patterns
- Use prompts to debug failures"
                    class="w-full p-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-400 focus:outline-none resize-none">{{ values.get('learning_outcomes','') }}</textarea>
        </div>

        <div class="flex flex-col sm:flex-row gap-3 mt-4">
          <button type="submit" class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-3 rounded-xl shadow-lg">Create Course Plan</button>
          <button type="submit" formaction="/create-course-pages" class="flex-1 border border-blue-500 text-blue-500 font-bold py-3 rounded-xl hover:bg-blue-50 transition">Build Module Pages</button>
          <button type="submit" formaction="/create-course-video" class="flex-1 border border-purple-500 text-purple-500 font-bold py-3 rounded-xl hover:bg-purple-50 transition">Generate Video</button>
          <button type="submit" formaction="/create-full-course" class="flex-1 border border-green-600 text-green-600 font-bold py-3 rounded-xl hover:bg-green-50 transition">Create Full Course</button>
        </div>
      </form>
    </div>

  </div>

  <!-- Loading Overlay -->
  <div id="loading-overlay" class="hidden fixed inset-0 bg-white/95 flex flex-col items-center justify-center z-50">
    <div class="bg-white p-8 rounded-2xl shadow-xl w-96 max-w-[90vw] text-center animate-fadeIn">
      <h2 class="text-2xl font-bold mb-4">Creating your content…</h2>
      <div class="w-full h-4 bg-gray-200 rounded-full overflow-hidden">
        <div id="progress-bar" class="h-full w-0 bg-gradient-to-r from-blue-500 to-purple-500"></div>
      </div>
      <p id="progress-text" class="mt-2 font-mono text-gray-700">0%</p>
      <p id="progress-hint" class="mt-2 text-gray-500">Drafting materials…</p>
    </div>
  </div>

</div>
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
