{% extends "base.html" %}

{% block title %}Agentic Full Course - {{ course_title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto bg-white p-8 md:p-10 rounded-2xl shadow-xl">
  <div class="mb-6">
    <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Agentic Full Course</h1>
    <p class="text-gray-600 mt-2">Generated end-to-end by the AgentManager and its agents.</p>
  </div>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Overview</h2>
    <p class="text-sm text-gray-600">
      <span class="font-semibold">Title:</span> {{ course_title }}<br>
      <span class="font-semibold">Audience:</span> {{ audience or "—" }}<br>
      <span class="font-semibold">Tone:</span> {{ tone or "—" }}<br>
      <span class="font-semibold">Duration (min):</span> {{ duration_minutes or "—" }}
    </p>
    <p class="mt-2 text-sm text-gray-600">
      <span class="font-semibold">Learning outcomes:</span>
    </p>
    <ul class="mt-1 list-disc list-inside text-sm text-gray-700">
      {% for outcome in learning_outcomes %}
      <li>{{ outcome }}</li>
      {% endfor %}
    </ul>
  </section>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Structure</h2>
    <p class="text-sm text-gray-600 mb-3">
      Planned by <span class="font-semibold">CoursePlannerAgent</span>, then expanded by the other agents.
    </p>
    <ul class="space-y-3 text-sm text-gray-800">
      {% for module in modules %}
      <li class="border-l-2 border-blue-200 pl-3">
        <div class="font-semibold">{{ module.title }}</div>
        <ul class="mt-1 ml-3 space-y-1 text-gray-700">
          {% for lesson in module.lessons %}
          <li>Lesson: {{ lesson }}</li>
          {% endfor %}
        </ul>
      </li>
      {% endfor %}
    </ul>
  </section>

  <section class="mb-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Artifacts (Preview)</h2>
    <p class="text-sm text-gray-600 mb-3">
      Content below is generated by the agentic pipeline. Videos are not rendered yet—you can review everything and then
      generate videos.
    </p>
    <div class="space-y-4">
      <div class="bg-gray-50 rounded-lg p-3 text-sm">
        <div class="font-semibold text-gray-800 mb-1">Lessons (LessonWriterAgent)</div>
        <ul class="space-y-2 max-h-64 overflow-auto border border-gray-200 rounded p-2 bg-white">
          {% for lesson in lessons %}
          <li>
            <div class="font-semibold text-gray-900">{{ lesson.title }}</div>
            <p class="text-gray-600 text-xs mt-1">{{ lesson.summary }}</p>
          </li>
          {% endfor %}
        </ul>
      </div>
      <div class="bg-gray-50 rounded-lg p-3 text-sm">
        <div class="font-semibold text-gray-800 mb-1">Quizzes (QuizAgent)</div>
        <p class="text-xs text-gray-600 mb-1">Each lesson has an associated quiz; below are counts only.</p>
        <p class="mt-1 text-gray-500">Total quizzes: {{ quizzes | length }}</p>
      </div>
      <div class="bg-gray-50 rounded-lg p-3 text-sm">
        <div class="font-semibold text-gray-800 mb-1">Videos (VideoScriptAgent / VideoGeneratorAgent)</div>
        <p class="text-xs text-gray-600">
          Scripts are generated, but full narrated videos have not been rendered in this preview step.
        </p>
      </div>
    </div>
  </section>

  <section>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Final Validation</h2>
    <p class="text-sm text-gray-600 mb-1">
      Status from <span class="font-semibold">ValidationAgent</span>:
      <span class="font-mono">{{ final_validation.status or "unknown" }}</span>
    </p>
    {% if final_validation.issues %}
    <p class="text-sm text-gray-600 mt-1">Issues noted:</p>
    <ul class="mt-1 list-disc list-inside text-xs text-gray-600">
      {% for issue in final_validation.issues %}
      <li>{{ issue }}</li>
      {% endfor %}
    </ul>
    {% else %}
    <p class="text-sm text-gray-600 mt-1">No issues reported.</p>
    {% endif %}
  </section>

  <section class="mt-8 border-t pt-4">
    <h2 class="text-lg font-semibold text-gray-800 mb-2">Next Step: Generate Videos & Final Course</h2>
    <p class="text-sm text-gray-600 mb-3">
      When you are satisfied with the agentic plan and content, click below to render full videos and finalize the
      course.
    </p>
    <form method="post" action="/agentic-finalize-course">
      <input type="hidden" name="course_title" value="{{ course_title }}">
      <input type="hidden" name="audience" value="{{ audience or '' }}">
      <input type="hidden" name="tone" value="{{ tone or '' }}">
      <input type="hidden" name="duration_minutes" value="{{ duration_minutes or '' }}">
      {# Preserve original outcomes as text so we can re-parse them server-side #}
      <input type="hidden" name="learning_outcomes" value="{{ learning_outcomes | join('\\n') }}">

      <div class="flex items-center mb-4">
        <input id="skip_video_finalize" name="skip_video" type="checkbox" value="true"
          class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
        <label for="skip_video_finalize" class="ml-2 block text-sm text-gray-900">
          Skip Video Rendering (Fast Mode)
        </label>
      </div>

      <button type="submit"
        class="px-4 py-3 font-semibold rounded-xl text-white bg-gradient-to-r from-blue-600 to-emerald-600 hover:from-blue-700 hover:to-emerald-700 shadow-lg transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
        Generate Videos &amp; Finalize Course
      </button>
    </form>
  </section>
</div>
{% endblock %}